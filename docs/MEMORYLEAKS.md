## Обнаружение и устранение утечек памяти в проекте игры Маджонг
### Введение
В ходе разработки веб-приложения игры Маджонг было замечено, что приложение загружалось очень долго и имело большие утечки памяти.
Причиной этому стало использование тяжеловесных изображений плиток, необходимых для украшения игры.
Данный документ содержит основную информацию по тому, как были выявлены утечки памяти и какие шаги предприняты для их устранения.

#### Что такое утечки памяти?
Для начала синхронизируемся в понимании определения "утечки памяти" - это происходит, когда программа продолжает удерживать ссылки на объекты,
которые больше не нужны, не позволяя сборщику мусора освобождать эту память. Данное событие может происходить по нескольким причинам, включая:

- Забытые ссылки на объекты. Когда объекты остаются в памяти из-за активных ссылок на них, даже если они больше не используются.
- Неосвобожденные обработчики событий. Если обработчики событий не удаляются, они могут удерживать ссылки на контекст, что приводит к утечкам.

#### Проблемы, вызванные утечками памяти
Утечки памяти могут привести к ряду проблем в веб-приложении, особенно в играх:

- Снижение производительности
Увеличение потребления памяти может замедлить приложение, вызывая задержки и фризы.

- Долгое время загрузки
Приложение может загружаться дольше, что негативно сказывается на пользовательском опыте.

- Краш приложения
В крайних случаях приложение может зависать или аварийно завершаться из-за исчерпания доступной памяти.

- Непредсказуемое поведение
Утечки могут привести к неожиданным ошибкам и сбоям, поскольку ресурсы не освобождаются.

#### 1. Обнаружение утечек памяти
#### 1.1 Анализ производительности.
В диагностике проблемы были использованы инструменты разработчика в браузере с помощью Performance и запуска профилирования во время загрузки игры.

#### Наблюдения и выявленные проблемы:
Долгое время загрузки.
Постепенное увеличение использования памяти при взаимодействии с приложением.
#### 1.2 Использование профилировщика памяти
С помощью вкладки Memory в инструментах разработчика был проведен анализ снимков памяти во время работы приложения.
Было обнаружено, что после загрузки изображений плиток объем памяти не уменьшался, даже после закрытия игрового поля.
Так же возникла проблема со ссылками на объекты - объекты изображений не освобождались, что тоже указывало на наличие утечек.
#### 2. Причины утечек
После анализа кода и профилировки памяти были установлены основные причины утечки - использование изображений в высоком разрешении,
что увеличивало потребление памяти, а так же неэффективное управление событиями, которые продолжали ссылаться на объекты изображений даже после их замены.
#### 3. Устранение утечек
#### 3.1 Замена изображений
Мы заменили тяжеловесные изображения плиток на более легкие форматы, плюс оптимизировали изображения с помощью сжатия.
#### 3.2 Улучшение управления памятью
В коде мы добавили явную отписку от всех событий, связанных с изображениями, при их удалении, дополнительно улучшили очистку обьектов. Это предотвратило зависание ссылок на объекты.

#### 4. Результаты
После всех изменений мы повторили тестирование и получили отличный результат:

- Улучшили производительность - время загрузки уменьшилось на 80%.
- Поправили моменты с использованием памяти, из-за чего уровень потребления памяти во время игры больше не увеличивался.
- По итогу, мы получили отсутствие утечек, что подтвердили повторным профилированием памяти.

### Заключение
Устранение утечек памяти было крутым шагом для улучшения производительности игры Маджонг, а оптимизация изображений и эффективное управление событиями позволили значительно улучшить пользовательский опыт. :)
